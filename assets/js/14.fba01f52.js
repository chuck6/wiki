(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{770:function(s,a,n){"use strict";n.r(a);var e=n(20),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"基本的api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基本的api"}},[s._v("#")]),s._v(" 基本的API")]),s._v(" "),n("h2",{attrs:{id:"查看集群的健康状况"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看集群的健康状况"}},[s._v("#")]),s._v(" 查看集群的健康状况")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("GET _cluster/health\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("当颜色为green，主分片与副本都正常分配；当颜色为Yellow，主分片全部正常分配，有副本分片未能正常分配；当颜色为Red，有主分片未能分配。")]),s._v(" "),n("h2",{attrs:{id:"查看所有index"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看所有index"}},[s._v("#")]),s._v(" 查看所有index")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("GET -cat/indices\n#查看indices\nGET /_cat/indices/kibana*?v&s=index\n#查看状态为绿的索引\nGET /_cat/indices?v&health=green\n#按照文档个数排序\nGET /_cat/indices?v&s=docs.count:desc\n#查看具体的字段\nGET /_cat/indices/kibana*?pri&v&h=health,index,pri,rep,docs.count,mt\n#How much memory is used per index?\nGET /_cat/indices?v&h=i,tm&s=tm:desc\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h2",{attrs:{id:"查看索引的mapping和setting设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看索引的mapping和setting设置"}},[s._v("#")]),s._v(" 查看索引的mapping和setting设置")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("GET kibana_sample_data_ecommerce\n#单独看mapping\nGET mapping_test/_mapping\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"查看索引中文档的总数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看索引中文档的总数"}},[s._v("#")]),s._v(" 查看索引中文档的总数")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("GET kibana_sample_data_ecommerce/_count\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"查看前10条文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看前10条文档"}},[s._v("#")]),s._v(" 查看前10条文档")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("POST kibana_sample_data_ecommerce/_search\n{\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"显式mapping设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#显式mapping设置"}},[s._v("#")]),s._v(" 显式mapping设置")]),s._v(" "),n("h3",{attrs:{id:"自定义mapping的建议"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自定义mapping的建议"}},[s._v("#")]),s._v(" 自定义mapping的建议")]),s._v(" "),n("ul",[n("li",[s._v("可以参考API手册，纯手写")]),s._v(" "),n("li",[s._v("为了减少输入的工作量，减少出错概率，可以依照以下步骤\n"),n("ul",[n("li",[s._v("创建一个临时的index，写入一些样本数据")]),s._v(" "),n("li",[s._v("通过访问mapping api获得该临时文件的动态mapping定义")]),s._v(" "),n("li",[s._v("修改后用该配置创建我们需要的索引")]),s._v(" "),n("li",[s._v("删除临时索引")])])])]),s._v(" "),n("h3",{attrs:{id:"控制当前字段是否被索引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#控制当前字段是否被索引"}},[s._v("#")]),s._v(" 控制当前字段是否被索引")]),s._v(" "),n("p",[s._v("mapping中的index字段是用来控制当前字段是否被索引。默认为true，如果设置成false，该字段不可被索引。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT users\n{\n    "mappings" : {\n      "properties" : {\n        "firstName" : {\n          "type" : "text"\n        },\n        "lastName" : {\n          "type" : "text"\n        },\n        "mobile" : {\n          "type" : "text",\n          "index": false\n        }\n      }\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h3",{attrs:{id:"控制倒排索引记录的内容"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#控制倒排索引记录的内容"}},[s._v("#")]),s._v(" 控制倒排索引记录的内容")]),s._v(" "),n("p",[s._v("mapping中的index options字段，有四种不同级别的设置，用来控制倒排索引记录的内容")]),s._v(" "),n("ul",[n("li",[s._v("docs 记录doc id")]),s._v(" "),n("li",[s._v("freqs 记录doc id和term frequencies")]),s._v(" "),n("li",[s._v("positions 记录doc id / term frequenies / term position")]),s._v(" "),n("li",[s._v("offsets 记录doc id / term frequenies / term position / character offects")])]),s._v(" "),n("p",[s._v("Text类型默认记录positions，其他默认为docs")]),s._v(" "),n("p",[s._v("记录内容越多，占用存储空间越大")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT users\n{\n    "mappings" : {\n      "properties" : {\n        "firstName" : {\n          "type" : "text"\n        },\n        "lastName" : {\n          "type" : "text"\n        },\n        "mobile" : {\n          "type" : "text",\n          "index_options": "offsets"\n        }\n      }\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h3",{attrs:{id:"实现对null值进行搜索"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现对null值进行搜索"}},[s._v("#")]),s._v(" 实现对NULL值进行搜索")]),s._v(" "),n("p",[s._v('mapping设置中，可以设置某个字段，"null_value":"NULL"，这样的话，就能实现对NULL值实现搜索。')]),s._v(" "),n("p",[s._v("注意的是，只有keyword类型支持设定 null_value")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT users\n{\n    "mappings" : {\n      "properties" : {\n        "firstName" : {\n          "type" : "text"\n        },\n        "lastName" : {\n          "type" : "text"\n        },\n        "mobile" : {\n          "type" : "keyword",\n          "null_value": "NULL"\n        }\n\n      }\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h3",{attrs:{id:"copy-to设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#copy-to设置"}},[s._v("#")]),s._v(" copy_to设置")]),s._v(" "),n("p",[s._v("可以满足一些场景，这个场景是输入的查询的字段的值，是已有的各个字段的结合的场景。例如输入的fullname的值，要匹配到mapping中的firstname和lastname。")]),s._v(" "),n("ul",[n("li",[s._v("_all在7中被copy_to所替代")]),s._v(" "),n("li",[s._v("满足一些特定的搜索需求")]),s._v(" "),n("li",[s._v("copy_to将字段的数值拷贝到目标字段，实现类似_all的作用")]),s._v(" "),n("li",[s._v("copy_to的目标字段不出现在_source中")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT users\n{\n  "mappings": {\n    "properties": {\n      "firstName":{\n        "type": "text",\n        "copy_to": "fullName"\n      },\n      "lastName":{\n        "type": "text",\n        "copy_to": "fullName"\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h3",{attrs:{id:"数组类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数组类型"}},[s._v("#")]),s._v(" 数组类型")]),s._v(" "),n("p",[s._v("es中不提供专门的数组类型。但是任何字段，都可以包含多个相同类型的数值。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT users/_doc/1\n{\n  "name":"twobirds",\n  "interests":["reading","music"]\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"定义index-alias"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#定义index-alias"}},[s._v("#")]),s._v(" 定义Index Alias")]),s._v(" "),n("p",[s._v("通过设置索引的别名，是的零停机运维。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST _aliases\n{\n  "actions": [\n    {\n      "add": {\n        "index": "movies-2019",\n        "alias": "movies-latest"\n      }\n    }\n  ]\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("设置alias创建不同查询的视图")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST _aliases\n{\n  "actions": [\n    {\n      "add": {\n        "index": "movies-2019",\n        "alias": "movies-lastest-highrate",\n        "filter": {\n          "range": {\n            "rating": {\n              "gte": 4\n            }\n          }\n        }\n      }\n    }\n  ]\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h2",{attrs:{id:"常见错误返回"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常见错误返回"}},[s._v("#")]),s._v(" 常见错误返回")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("问题")]),s._v(" "),n("th",[s._v("原因")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("无法连接")]),s._v(" "),n("td",[s._v("网络故障或集群挂了")])]),s._v(" "),n("tr",[n("td",[s._v("连接无法关闭")]),s._v(" "),n("td",[s._v("网络故障或节点出错")])]),s._v(" "),n("tr",[n("td",[s._v("429")]),s._v(" "),n("td",[s._v("集群过于繁忙")])]),s._v(" "),n("tr",[n("td",[s._v("4XX")]),s._v(" "),n("td",[s._v("请求体格式有错")])]),s._v(" "),n("tr",[n("td",[s._v("500")]),s._v(" "),n("td",[s._v("集群内部错误")])])])]),s._v(" "),n("h2",{attrs:{id:"analyzer-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#analyzer-api"}},[s._v("#")]),s._v(" _analyzer API")]),s._v(" "),n("p",[s._v("analyzer api是ES自带的API，目的是用来分析和测试研究ES如何进行分词的。有如下三种使用的方式：")]),s._v(" "),n("p",[s._v("第一种方式：通过GET直接指定Analyzer来进行测试")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /_analyze\n{\n  "analyzer": "standard"\n  "text": "Mastering Elasticsearch, elasticsearch is Action"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("第二种方式：通过POST索引名上的某个字段来进行测试")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST books/_analyze\n{\n  "field": "title",\n  "text": "Mastering Elasticsearch"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("第三种方式：通过POST自定义分词器来进行测试")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST /_analyze\n{\n  "tokenizer": "standard",\n  "filter": ["lowercase"],\n  "text": "Mastering Elasticsearch"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"create-一个文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#create-一个文档"}},[s._v("#")]),s._v(" Create 一个文档")]),s._v(" "),n("h3",{attrs:{id:"index的方法与create方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#index的方法与create方法"}},[s._v("#")]),s._v(" Index的方法与create方法")]),s._v(" "),n("h4",{attrs:{id:"index方法与create方法的联系"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#index方法与create方法的联系"}},[s._v("#")]),s._v(" index方法与create方法的联系")]),s._v(" "),n("p",[s._v("都可以用于创建一个新的文档")]),s._v(" "),n("h4",{attrs:{id:"index方法与create方法的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#index方法与create方法的区别"}},[s._v("#")]),s._v(" index方法与create方法的区别")]),s._v(" "),n("p",[s._v("put和post上面的区别")]),s._v(" "),n("ul",[n("li",[s._v("index只有put方法，并且一定要带上文档id")]),s._v(" "),n("li",[s._v("create可以使用put 或post")])]),s._v(" "),n("p",[s._v("是否需要指定文档id")]),s._v(" "),n("ul",[n("li",[s._v("需要指定文档id，只能用PUT")]),s._v(" "),n("li",[s._v("不指定文档id的情况下，只能用POST")])]),s._v(" "),n("p",[s._v("对待已经存在文档id的情况(指定了文档ID，只能用PUT)")]),s._v(" "),n("ul",[n("li",[s._v("index方法中，如果文档的ID不存在，那么久创建新的文档。否则会先删除现有的文档，再创建新的文档，版本会增加。")]),s._v(" "),n("li",[s._v("create方法中，如果文档的ID已经存在，会创建失败。")])]),s._v(" "),n("p",[s._v("是否想要自动生成文档id的情况")]),s._v(" "),n("ul",[n("li",[s._v("index方法无法自动生成文档id")]),s._v(" "),n("li",[s._v("create方法可以自动生成文档id")])]),s._v(" "),n("h4",{attrs:{id:"index方法的api-只有put"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#index方法的api-只有put"}},[s._v("#")]),s._v(" index方法的API(只有PUT)")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT my_index/_doc/1\n{\n    "user" : "Jack",\n    "post_date" : "2019-05-15T14:12:12",\n    "message" : "trying out Elasticsearch"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h4",{attrs:{id:"create方法的api-put带上文档id"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#create方法的api-put带上文档id"}},[s._v("#")]),s._v(" create方法的API(PUT带上文档ID)")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT my_index/_create/1\n{\n    "user" : "Jack",\n    "post_date" : "2019-05-15T14:12:12",\n    "message" : "trying out Elasticsearch"\n}\nPUT users/_doc/1?op_type=create\n{\n    "user" : "Jack",\n    "post_date" : "2019-05-15T14:12:12",\n    "message" : "trying out Elasticsearch"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h4",{attrs:{id:"create方法的api-post不带上文档id"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#create方法的api-post不带上文档id"}},[s._v("#")]),s._v(" create方法的API(POST不带上文档ID)")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST users/_doc\n{\n\t"user" : "Mike",\n    "post_date" : "2019-04-15T14:12:12",\n    "message" : "trying out Kibana"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"read一个文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#read一个文档"}},[s._v("#")]),s._v(" Read一个文档")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("GET my_index/_doc/1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("找到文档，会返回HTTP 200；找不到文档，会返回HTTP 404")]),s._v(" "),n("h2",{attrs:{id:"update一个文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#update一个文档"}},[s._v("#")]),s._v(" Update一个文档")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#Update 指定 ID  (先删除，在写入)\n#文档必须已经存在，更新只会对相应字段做增量修改\n#POST方法中，payload需要包含在"doc"中\nPOST users/_update/1\n{\n\t"doc":\n\t{\n\t  "user" : "user1",\n      "post_date" : "2019-04-15T14:12:12",\n      "message" : "trying out Kibanadddddd"\n\t}\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h2",{attrs:{id:"delete一个文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#delete一个文档"}},[s._v("#")]),s._v(" Delete一个文档")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("### Delete by Id\n# 删除文档\nDELETE users/_doc/1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"bulk-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#bulk-api"}},[s._v("#")]),s._v(" Bulk API")]),s._v(" "),n("ul",[n("li",[s._v("支持在一次API调用中，对不同的索引进行操作")]),s._v(" "),n("li",[s._v("支持四种类型操作：index \\ create \\ update \\ delete")]),s._v(" "),n("li",[s._v("可以在URL中指定index，也可以在请求的payload中进行")]),s._v(" "),n("li",[s._v("操作中单条操作失败，并不会影响其他操作")]),s._v(" "),n("li",[s._v("返回结果包括了每一条操作执行的结果")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST _bulk\n{ "index" : { "_index" : "test", "_id" : "1" } }\n{ "field1" : "value1" }\n{ "delete" : { "_index" : "test", "_id" : "2" } }\n{ "create" : { "_index" : "test2", "_id" : "3" } }\n{ "field1" : "value3" }\n{ "update" : {"_id" : "1", "_index" : "test"} }\n{ "doc" : {"field2" : "value2"} }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v('其中"index"/"delete"/"create"/"update"是CRUD中的CUD。')]),s._v(" "),n("p",[s._v('"filed1"和"filed2"是相应的列名，后面跟的是value值。')]),s._v(" "),n("h2",{attrs:{id:"mget批量读取"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mget批量读取"}},[s._v("#")]),s._v(" mget批量读取")]),s._v(" "),n("p",[s._v("批量操作，可以减少网络连接所产生的开销，提高性能")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('### mget 操作\nGET /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1"\n        },\n        {\n            "_index" : "test",\n            "_id" : "2"\n        }\n    ]\n}\n#URI中指定index\nGET /test/_mget\n{\n    "docs" : [\n        {\n\n            "_id" : "1"\n        },\n        {\n\n            "_id" : "2"\n        }\n    ]\n}\nGET /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1",\n            "_source" : false\n        },\n        {\n            "_index" : "test",\n            "_id" : "2",\n            "_source" : ["field3", "field4"]\n        },\n        {\n            "_index" : "test",\n            "_id" : "3",\n            "_source" : {\n                "include": ["user"],\n                "exclude": ["user.location"]\n            }\n        }\n    ]\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br")])]),n("h2",{attrs:{id:"msearch-批量查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#msearch-批量查询"}},[s._v("#")]),s._v(" msearch 批量查询")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST kibana_sample_data_ecommerce/_msearch\n{}\n{"query" : {"match_all" : {}},"size":1}\n{"index" : "kibana_sample_data_flights"}\n{"query" : {"match_all" : {}},"size":2}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"mget与msearch的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mget与msearch的区别"}},[s._v("#")]),s._v(" mget与msearch的区别")]),s._v(" "),n("p",[s._v("mget是通过文档ID列表得到文档信息，而msearch是根据查询条件，搜索到相应文档。")]),s._v(" "),n("h3",{attrs:{id:"单次批量操作注意事项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单次批量操作注意事项"}},[s._v("#")]),s._v(" 单次批量操作注意事项")]),s._v(" "),n("p",[s._v("单次批量操作，数据量不宜过大，以免引发性能问题。")]),s._v(" "),n("p",[s._v("一般建议是1000-5000个文档，如果文档很大，可以适当减少队列，大小建议为5-15MB，默认不能超过100M，会报错。")]),s._v(" "),n("h2",{attrs:{id:"search-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#search-api"}},[s._v("#")]),s._v(" Search API")]),s._v(" "),n("p",[s._v("返回体中的字段意思")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("took")]),s._v(" "),n("th",[s._v("花费的时间")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("total")]),s._v(" "),n("td",[s._v("符合条件的总文档数")])]),s._v(" "),n("tr",[n("td",[s._v("hints")]),s._v(" "),n("td",[s._v("结果集，默认是前10个文档")])]),s._v(" "),n("tr",[n("td",[s._v("_index")]),s._v(" "),n("td",[s._v("索引名")])]),s._v(" "),n("tr",[n("td",[s._v("_id")]),s._v(" "),n("td",[s._v("文档的ID")])]),s._v(" "),n("tr",[n("td",[s._v("_score")]),s._v(" "),n("td",[s._v("相关度评分")])]),s._v(" "),n("tr",[n("td",[s._v("_source")]),s._v(" "),n("td",[s._v("文档原始信息")])])])]),s._v(" "),n("h2",{attrs:{id:"uri-search"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#uri-search"}},[s._v("#")]),s._v(" URI Search")]),s._v(" "),n("p",[s._v("也就是在URL中使用查询参数")]),s._v(" "),n("h3",{attrs:{id:"uri-search基本查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#uri-search基本查询"}},[s._v("#")]),s._v(" URI Search基本查询")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#基本查询\nGET /movies/_search?q=2012&df=title&sort=year:desc&from=0&size=10&timeout=1s\n{\n  "profile":"true"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("q指定查询语句，使用Query String Syntax")]),s._v(" "),n("li",[s._v("df默认字段，是指查询的字段filed，不指定时就是对所有字段")]),s._v(" "),n("li",[s._v("Sort排序")]),s._v(" "),n("li",[s._v("from 和size用于分页")]),s._v(" "),n("li",[s._v("Profile可以查看查询是如何被执行的（查看使用了什么查询）")])]),s._v(" "),n("h3",{attrs:{id:"uri-search指定字段查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#uri-search指定字段查询"}},[s._v("#")]),s._v(" URI Search指定字段查询")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /movies/_search?q=2012&df=title\n{\n\t"profile":"true"\n}\n#或者没有df字段，使用title:2012的方式\nGET /movies/_search?q=title:2012\n{\n\t"profile":"true"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("就是查询title字段是2012的文档")]),s._v(" "),n("h3",{attrs:{id:"uri-search泛查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#uri-search泛查询"}},[s._v("#")]),s._v(" URI Search泛查询")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#泛查询，正对_all,所有字段\nGET /movies/_search?q=2012\n{\n\t"profile":"true"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"uri-search-term查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#uri-search-term查询"}},[s._v("#")]),s._v(" URI Search Term查询")]),s._v(" "),n("p",[s._v("简而言之就是指定了term单词的查询，和上面指定了title是2012就是term query。和上面的指定字段查询类似")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /movies/_search?q=title:2012\n{\n\t"profile":"true"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"uri-search-phrase查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#uri-search-phrase查询"}},[s._v("#")]),s._v(" URI Search Phrase查询")]),s._v(" "),n("p",[s._v("也就是带多个单词，词组的查询。这里要考虑要引号和括号(分组)的不同含义。")]),s._v(" "),n("h4",{attrs:{id:"不加引号和括号"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#不加引号和括号"}},[s._v("#")]),s._v(" 不加引号和括号")]),s._v(" "),n("p",[s._v("例如查找美丽心灵的影片，使用q=title:Beautiful Mind，通过profile的查询过程可以看出使用的是BooleanQuery，等效于tile字段中包含Beatiful，其他字段(也包含title字段)。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /movies/_search?q=title:Beautiful Mind\n{\n\t"profile":"true"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"加上引号"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#加上引号"}},[s._v("#")]),s._v(" 加上引号")]),s._v(" "),n("p",[s._v('"Beautiful Mind",等效于Beautiful AND Mind.这是PhraseQuery，在查询的时候要求这两个单词要同时出现，并且还要求前后的顺序保持一致。')]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#使用引号，Phrase查询\nGET /movies/_search?q=title:"Beautiful Mind"\n{\n\t"profile":"true"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"加上括号"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#加上括号"}},[s._v("#")]),s._v(" 加上括号")]),s._v(" "),n("p",[s._v("和前面不加上括号的相比，这是布尔查询，意思是在title字段中，或者出现Beautiful或者出现Mind，或者都可以出现。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#分组，Bool查询\nGET /movies/_search?q=title:(Beautiful Mind)\n{\n\t"profile":"true"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"布尔操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#布尔操作"}},[s._v("#")]),s._v(" 布尔操作")]),s._v(" "),n("p",[s._v("在单词之间加入AND/OR/NOT或者&& / || !")]),s._v(" "),n("p",[s._v("必须要大写")]),s._v(" "),n("p",[s._v("AND：意思是必须包含Beautiful和Mind，但是对之间的顺序没有要求")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 查找美丽心灵\nGET /movies/_search?q=title:(Beautiful AND Mind)\n{\n\t"profile":"true"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("OR：意思是或者包含Beautiful，或者包含Mind，或者包含这两个，但是对这两个词的顺序没有要求")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /movies/_search?q=title:(Beautiful OR Mind)\n{\n\t"profile":"true"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("NOT：意思是包含Beautiful，不包含Mind")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /movies/_search?q=title:(Beautiful NOT Mind)\n{\n\t"profile":"true"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"分组"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分组"}},[s._v("#")]),s._v(" 分组")]),s._v(" "),n("p",[s._v("+：表示must，也就是一定要有，must后面跟的单词是必须要存在的。")]),s._v(" "),n("p",[s._v("%2B：表示的是+的意思。")]),s._v(" "),n("p",[s._v("-：表示must_not，也就是后面跟的单词一定要不存在。")]),s._v(" "),n("p",[s._v("注意：")]),s._v(" "),n("p",[s._v("单独使用+的时候，没有任何含义，和没有+一个意思。")]),s._v(" "),n("p",[s._v("单独使用-的时候 ，是有意义的。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /movies/_search?q=title:(+Beautiful -Mind)\n{\n\t"profile":"true"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"范围查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#范围查询"}},[s._v("#")]),s._v(" 范围查询")]),s._v(" "),n("p",[s._v("区间表示：[]闭区间，{}开区间")]),s._v(" "),n("ul",[n("li",[s._v("year:{2019 TO 2018]")]),s._v(" "),n("li",[s._v("year:[* TO 2018]")]),s._v(" "),n("li",[s._v("year:[2002 TO 2018%7D  等同于[2002 TO 2018}")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /movies/_search?q=title:beautiful AND year:[2002 TO 2018]\n{\n\t"profile":"true"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"算数符号"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#算数符号"}},[s._v("#")]),s._v(" 算数符号")]),s._v(" "),n("ul",[n("li",[s._v("year:>2010")]),s._v(" "),n("li",[s._v("year:(>2010 && <=2018)")]),s._v(" "),n("li",[s._v("year:(+>2010 +<=2018)")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /movies/_search?q=year:(>2010 AND  <=2018)\n{\n\t"profile":"true"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"通配符查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#通配符查询"}},[s._v("#")]),s._v(" 通配符查询")]),s._v(" "),n("p",[s._v("通配符查询(通配符查询效率低，占用内存大，不建议使用。特别是放在最前面)")]),s._v(" "),n("p",[s._v("? 代表1个字符，* 代表0或多个字符")]),s._v(" "),n("ul",[n("li",[s._v("title:mi?d")]),s._v(" "),n("li",[s._v("title:be*")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#通配符查询\nGET /movies/_search?q=title:b*\n{\n\t"profile":"true"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"模糊匹配"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#模糊匹配"}},[s._v("#")]),s._v(" 模糊匹配")]),s._v(" "),n("p",[s._v("title:befutifl~1")]),s._v(" "),n("p",[s._v("就是指当有单词输入错误的时候，做一个模糊的匹配")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /movies/_search?q=title:beautifl~1\n{\n\t"profile":"true"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"近似匹配"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#近似匹配"}},[s._v("#")]),s._v(" 近似匹配")]),s._v(" "),n("p",[s._v("当输入的多个单词的时候，不要求他们一定要保证相应的顺序出现，但是两个都必须存在。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /movies/_search?q=title:"Lord Rings"~2\n{\n\t"profile":"true"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h2",{attrs:{id:"request-body-search"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#request-body-search"}},[s._v("#")]),s._v(" Request Body Search")]),s._v(" "),n("p",[s._v("使用的ES内置的，也就是说在查询体中带上JSON格式，使用特定的DSL的语言方法来查询，使用最为广泛。")]),s._v(" "),n("p",[s._v("分页查询/排序/source过滤字段/脚本字段，这些配置都是在定义query的查询体的上面来定义的。")]),s._v(" "),n("h3",{attrs:{id:"分页查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分页查询"}},[s._v("#")]),s._v(" 分页查询")]),s._v(" "),n("p",[s._v('在不添加任何"from"和"size"的时候，from默认是从0开始，size是10。也就是从每个主分片上捞取from+size的数据汇聚，然后捞取前10条数据返回。')]),s._v(" "),n("p",[s._v('"from"的意思就是定义了要查询数据的起始位置，如果from是10，那么就是说从第10条开始数据返回。')]),s._v(" "),n("p",[s._v('"size"的意思是起始位置开始要返回的数据量的大小，如果size是10，那么就要从from的起始位置开始，返回10条数据。')]),s._v(" "),n("p",[s._v("获取靠后的翻页成本较高。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST /kibana_sample_data_ecommerce/_search\n{\n  "from":10,\n  "size":20,\n  "query":{\n    "match_all": {}\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h3",{attrs:{id:"排序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#排序"}},[s._v("#")]),s._v(" 排序")]),s._v(" "),n("p",[s._v('最好在"数字型"与"日期型"字段上排序')]),s._v(" "),n("p",[s._v("因为对于多值类型或分析过的字段排序，系统会选一个值，无法得知该值。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#对日期排序\nPOST kibana_sample_data_ecommerce/_search\n{\n  "sort":[{"order_date":"desc"}],\n  "query":{\n    "match_all": {}\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h3",{attrs:{id:"source字段过滤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#source字段过滤"}},[s._v("#")]),s._v(" source字段过滤")]),s._v(" "),n("p",[s._v("就是针对查询出来的结果过滤到相应的字段的查询。")]),s._v(" "),n("p",[s._v("如果_source没有存储，那就只返回匹配的文档的元数据")]),s._v(" "),n("p",[s._v('_source支持使用通配符，例如_source["name*","desc*"]')]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#source filtering\nPOST kibana_sample_data_ecommerce/_search\n{\n  "_source":["order_date"],\n  "query":{\n    "match_all": {}\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h3",{attrs:{id:"脚本字段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#脚本字段"}},[s._v("#")]),s._v(" 脚本字段")]),s._v(" "),n("p",[s._v("针对于当订单中有不同的汇率，需要结合汇率对订单价格进行排序的情况。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET kibana_sample_data_ecommerce/_search\n{\n  "script_fields": {\n    "new_field": {\n      "script": {\n        "lang": "painless",\n        "source": "doc[\'order_date\'].value+\'hello\'"\n      }\n    }\n  },\n  "query": {\n    "match_all": {}\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h3",{attrs:{id:"全文查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#全文查询"}},[s._v("#")]),s._v(" 全文查询")]),s._v(" "),n("h4",{attrs:{id:"match-all的查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#match-all的查询"}},[s._v("#")]),s._v(" match_all的查询")]),s._v(" "),n("p",[s._v("在query下面使用match_all来查询，默认返回10条数据。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#ignore_unavailable=true，可以忽略尝试访问不存在的索引“404_idx”导致的报错\n#查询movies分页\nPOST /movies,404_idx/_search?ignore_unavailable=true\n{\n  "profile": true,\n\t"query": {\n\t\t"match_all": {}\n\t}\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h4",{attrs:{id:"match的查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#match的查询"}},[s._v("#")]),s._v(" match的查询")]),s._v(" "),n("p",[s._v("查询单个单词的时候像是URI Search中的term search，如果查询多个单词的时候又有点像URI Search中的phrase search。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#使用查询表达式 match，默认是OR的方式\nPOST movies/_search\n{\n  "query": {\n    "match": {\n      "title": "last christmas"\n    }\n  }\n}\n可以使用AND的方式\nPOST movies/_search\n{\n  "query": {\n    "match": {\n      "title": {\n        "query": "last christmas",\n        "operator": "and"\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h4",{attrs:{id:"match-phrase查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#match-phrase查询"}},[s._v("#")]),s._v(" match phrase查询")]),s._v(" "),n("p",[s._v("专门用于短语的搜索，感觉功能上比match query要更灵活一些。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#加入了slop的时候，就是允许在这些短语的中间加入一个其他的单词\nPOST movies/_search\n{\n  "query": {\n    "match_phrase": {\n      "title":{\n        "query": "one love",\n        "slop": 1\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h4",{attrs:{id:"query-string-query"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#query-string-query"}},[s._v("#")]),s._v(" Query String Query")]),s._v(" "),n("p",[s._v("query string query和下面的simple query string query使用场景比较少。")]),s._v(" "),n("p",[s._v("query string 比simple query string使用起来更加灵活。")]),s._v(" "),n("p",[s._v("query string 有点类似于URI Query")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#里面也有和URI Search中的DF字段\nPOST users/_search\n{\n  "query": {\n    "query_string": {\n      "default_field": "name",\n      "query": "Ruan AND Yiming"\n    }\n  }\n}\n#也支持多个字段的查询，和URI Search中一样，括号代表分组\nPOST users/_search\n{\n  "query": {\n    "query_string": {\n      "fields":["name","about"],\n      "query": "(Ruan AND Yiming) OR (Java AND Elasticsearch)"\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("h4",{attrs:{id:"simple-query-string-query"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#simple-query-string-query"}},[s._v("#")]),s._v(" Simple Query String Query")]),s._v(" "),n("ul",[n("li",[s._v("类似Query String，但是会忽略错误的语法，同时只支持部分查询语法")]),s._v(" "),n("li",[s._v("不支持AND OR NOT，会当作字符串处理")]),s._v(" "),n("li",[s._v("Term之间默认的关系是OR，可以指定operator")]),s._v(" "),n("li",[s._v("支持部分逻辑\n"),n("ul",[n("li",[s._v("+代替AND")]),s._v(" "),n("li",[s._v("|代替OR")]),s._v(" "),n("li",[s._v("-代替NOT")])])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#Simple Query 默认的operator是 Or\nPOST users/_search\n{\n  "query": {\n    "simple_query_string": {\n      "query": "Ruan AND Yiming",\n      "fields": ["name"]\n    }\n  }\n}\nPOST users/_search\n{\n  "query": {\n    "simple_query_string": {\n      "query": "Ruan Yiming",\n      "fields": ["name"],\n      "default_operator": "AND"\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("h3",{attrs:{id:"精确值查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#精确值查询"}},[s._v("#")]),s._v(" 精确值查询")]),s._v(" "),n("p",[s._v("结构化数据，日期，数字，布尔，term 。。。。")]),s._v(" "),n("h4",{attrs:{id:"term-query"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#term-query"}},[s._v("#")]),s._v(" Term query")]),s._v(" "),n("p",[s._v("可以理解为是对精确值的查询。")]),s._v(" "),n("p",[s._v("但是Term 查询的特点是不会对查询所带的字段进行分词处理，而索引文档中的text类型的字段值，在输入的时候会对text类型进行分词，小写化处理。")]),s._v(" "),n("p",[s._v("要不查询的时候，字段值全用小写；要么使用text的keyword来进行精确匹配，也就是查询的时候输入插入的时候的值的大小写。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 改为小写查询，如果多个单词在一起的，使用起来还是要注意\nPOST /products/_search\n{\n  "query": {\n    "term": {\n      "desc": {\n        //"value": "iPhone"\n        "value":"iphone"\n      }\n    }\n  }\n}\n#使用keyword进行精确匹配\nPOST /products/_search\n{\n  //"explain": true,\n  "query": {\n    "term": {\n      "productID.keyword": {\n        "value": "XHDK-A-1293-#fJ3"\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("h4",{attrs:{id:"constant-score转为filter"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#constant-score转为filter"}},[s._v("#")]),s._v(" constant score转为filter")]),s._v(" "),n("p",[s._v("将query转为filter过滤，忽略掉了TF-IDF的算分过程，避免了相关性算分的开销。并且Filter可以有效利用缓存")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST /products/_search\n{\n  "explain": true,\n  "query": {\n    "constant_score": {\n      "filter": {\n        "term": {\n          "productID.keyword": "XHDK-A-1293-#fJ3"\n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h4",{attrs:{id:"布尔值"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#布尔值"}},[s._v("#")]),s._v(" 布尔值")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#对布尔值 match 查询，有算分\nPOST products/_search\n{\n  "profile": "true",\n  "explain": true,\n  "query": {\n    "term": {\n      "avaliable": {\n        "value": "false"\n      }\n    }\n  }\n}\n#一般对布尔值查询会结合上面的过滤到算法\n#对布尔值，通过constant score 转成 filtering，没有算分\nPOST products/_search\n{\n  "profile": "true",\n  "explain": true,\n  "query": {\n    "constant_score": {\n      "filter": {\n        "term": {\n          "avaliable": {\n            "value": "false"\n          }\n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])]),n("h4",{attrs:{id:"查找多个精确值"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查找多个精确值"}},[s._v("#")]),s._v(" 查找多个精确值")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#字符类型 terms\nPOST products/_search\n{\n  "query": {\n    "constant_score": {\n      "filter": {\n        "terms": {\n          "productID.keyword": [\n            "QQPX-R-3956-#aD8",\n            "JODL-X-1937-#pV7"\n          ]\n        }\n      }\n    }\n  }\n}\n#处理多值字段，term 查询是包含，而不是等于\n#针对的是这个term字段的值是一个数值，而并非是唯一的值的情况下\n#可以通过添加一个genre count字段对每个文档的该字段的数组里面的值多个统计\n#在查询的时候，通过去定义这个字段的应该有的值的个数去精确匹配\nPOST movies/_search\n{\n  "query": {\n    "constant_score": {\n      "filter": {\n        "term": {\n          "genre.keyword": "Comedy"\n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("h3",{attrs:{id:"range"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#range"}},[s._v("#")]),s._v(" Range")]),s._v(" "),n("h4",{attrs:{id:"数字range"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数字range"}},[s._v("#")]),s._v(" 数字Range")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#数字 Range 查询\nGET products/_search\n{\n    "query" : {\n        "constant_score" : {\n            "filter" : {\n                "range" : {\n                    "price" : {\n                        "gte" : 20,\n                        "lte"  : 30\n                    }\n                }\n            }\n        }\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("gt大于")]),s._v(" "),n("p",[s._v("lt小于")]),s._v(" "),n("p",[s._v("gte大于等于")]),s._v(" "),n("p",[s._v("lte小于等于")]),s._v(" "),n("h4",{attrs:{id:"日期range"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#日期range"}},[s._v("#")]),s._v(" 日期Range")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 日期 range\nPOST products/_search\n{\n    "query" : {\n        "constant_score" : {\n            "filter" : {\n                "range" : {\n                    "date" : {\n                      "gte" : "now-1y"\n                    }\n                }\n            }\n        }\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("y 年、M 月、w 周、d 天、H或h 小时、m 分钟、s 秒")]),s._v(" "),n("h3",{attrs:{id:"exists查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#exists查询"}},[s._v("#")]),s._v(" exists查询")]),s._v(" "),n("p",[s._v("使用exist查询来处理"),n("strong",[s._v("非空NULL值")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#查询存在相应列的文档\n#exists查询\nPOST products/_search\n{\n  "query": {\n    "constant_score": {\n      "filter": {\n        "exists": {\n          "field": "date"\n        }\n      }\n    }\n  }\n}\n#查询不存在相应列的文档\nPOST products/_search\n{\n  "query": {\n    "constant_score": {\n      "filter": {\n        "bool": {\n          "must_not": {\n            "exists": {\n              "field": "date"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])]),n("h3",{attrs:{id:"bool查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#bool查询"}},[s._v("#")]),s._v(" bool查询")]),s._v(" "),n("p",[s._v("bool查询是复合查询。must / should是query context贡献算分；must_not /  filter是filter context不贡献算分。")]),s._v(" "),n("p",[s._v("子查询可以任意顺序出现；")]),s._v(" "),n("p",[s._v("可以嵌套多个查询；")]),s._v(" "),n("p",[s._v("在bool查询中，没有must条件的时候，should中必须至少满足一条查询。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#基本语法\nPOST /products/_search\n{\n  "query": {\n    "bool" : {\n      "must" : {\n        "term" : { "price" : "30" }\n      },\n      "filter": {\n        "term" : { "avaliable" : "true" }\n      },\n      "must_not" : {\n        "range" : {\n          "price" : { "lte" : 10 }\n        }\n      },\n      "should" : [\n        { "term" : { "productID.keyword" : "JODL-X-1937-#pV7" } },\n        { "term" : { "productID.keyword" : "XHDK-A-1293-#fJ3" } }\n      ],\n      "minimum_should_match" :1\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("h4",{attrs:{id:"解决term-query包含而不是相等问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决term-query包含而不是相等问题"}},[s._v("#")]),s._v(" 解决term query包含而不是相等问题")]),s._v(" "),n("p",[s._v("针对term查询的字段，如果是一个数组类型的时候，term查询是包含而不是相等的问题，通过bool查询来解决，需要新增一个数组里面值的个数的字段。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#must，有算分\nPOST /newmovies/_search\n{\n  "query": {\n    "bool": {\n      "must": [\n        {"term": {"genre.keyword": {"value": "Comedy"}}},\n        {"term": {"genre_count": {"value": 1}}}\n\n      ]\n    }\n  }\n}\n#Filter。不参与算分，结果的score是0\nPOST /newmovies/_search\n{\n  "query": {\n    "bool": {\n      "filter": [\n        {"term": {"genre.keyword": {"value": "Comedy"}}},\n        {"term": {"genre_count": {"value": 1}}}\n        ]\n\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("h4",{attrs:{id:"bool嵌套查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#bool嵌套查询"}},[s._v("#")]),s._v(" bool嵌套查询")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#嵌套，实现了 should not 逻辑\nPOST /products/_search\n{\n  "query": {\n    "bool": {\n      "must": {\n        "term": {\n          "price": "30"\n        }\n      },\n      "should": [\n        {\n          "bool": {\n            "must_not": {\n              "term": {\n                "avaliable": "false"\n              }\n            }\n          }\n        }\n      ],\n      "minimum_should_match": 1\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("h5",{attrs:{id:"改变相关度算分"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#改变相关度算分"}},[s._v("#")]),s._v(" 改变相关度算分")]),s._v(" "),n("p",[s._v("通过嵌套的bool查询中的问题，来改变相关度的算分的问题。")]),s._v(" "),n("p",[s._v("在同一层级下竞争字段，具有相同的权重；通过嵌套bool查询，可以改变对算分的影响。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#同级查询\nPOST /animals/_search\n{\n  "query": {\n    "bool": {\n      "should": [\n        { "term": { "text": "brown" }},\n        { "term": { "text": "red" }},\n        { "term": { "text": "quick"   }},\n        { "term": { "text": "dog"   }}\n      ]\n    }\n  }\n}\n#嵌套多级查询\nPOST /animals/_search\n{\n  "query": {\n    "bool": {\n      "should": [\n        { "term": { "text": "quick" }},\n        { "term": { "text": "dog"   }},\n        {\n          "bool":{\n            "should":[\n               { "term": { "text": "brown" }},\n                 { "term": { "text": "brown" }},\n            ]\n          }\n\n        }\n      ]\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])]),n("h3",{attrs:{id:"boosting-query"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#boosting-query"}},[s._v("#")]),s._v(" Boosting Query")]),s._v(" "),n("h4",{attrs:{id:"控制字段的boosting"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#控制字段的boosting"}},[s._v("#")]),s._v(" 控制字段的boosting")]),s._v(" "),n("p",[s._v("在bool查询中，通过指定boost的值来实现影响算分，控制相关度。")]),s._v(" "),n("p",[s._v("参数boost的含义：当boost>1的时候，打分的相关度相对性提升；当0<boost<1的时候，打分的权重相对性降低;当boost<0的时候，贡献负分。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST blogs/_search\n{\n  "query": {\n    "bool": {\n      "should": [\n        {"match": {\n          "title": {\n            "query": "apple,ipad",\n            "boost": 1.1\n          }\n        }},\n        {"match": {\n          "content": {\n            "query": "apple,ipad",\n            "boost": 2\n          }\n        }}\n      ]\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h4",{attrs:{id:"not-quite-not"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#not-quite-not"}},[s._v("#")]),s._v(" Not Quite Not")]),s._v(" "),n("p",[s._v("意思是查询的时候，正确的值要第一个返回(例如这里我要求查询的苹果公司产品要优先出现)，其他相关的(苹果汁，苹果派的)等信息也要返回，但是是靠后面返回。")]),s._v(" "),n("p",[s._v("提高了查准率和查全率。")]),s._v(" "),n("p",[s._v("使用了boosting query的方式来实现。positive的值是对查询算法加分的，negative的值是对查询算分减分的，negative_boost是指减多少分。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST news/_search\n{\n  "query": {\n    "boosting": {\n      "positive": {\n        "match": {\n          "content": "apple"\n        }\n      },\n      "negative": {\n        "match": {\n          "content": "pie"\n        }\n      },\n      "negative_boost": 0.5\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h3",{attrs:{id:"disjunction-max-query"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#disjunction-max-query"}},[s._v("#")]),s._v(" Disjunction Max Query")]),s._v(" "),n("p",[s._v("Disjunction Max Query应用于单字符串多字段查询的场景，很多搜索引擎都是这样的。允许你只是输入一个字符串，要多所有的字段进行查询。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST blogs/_search\n{\n    "query": {\n        "dis_max": {\n            "queries": [\n                { "match": { "title": "Quick pets" }},\n                { "match": { "body":  "Quick pets" }}\n            ]\n        }\n    }\n}\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h4",{attrs:{id:"使用tie-breaker参数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用tie-breaker参数"}},[s._v("#")]),s._v(" 使用tie breaker参数")]),s._v(" "),n("p",[s._v("有一些情况下，同时匹配title和body字段的文档比只与一个字段匹配的文档的相关度更高。而disjunction max query 查询只会简单地使用单个最佳匹配语句的评分_score作为整体评分。这个时候，可以使用tie_breaker参数来调整。")]),s._v(" "),n("ul",[n("li",[s._v("获取最佳匹配语句的评分_score;")]),s._v(" "),n("li",[s._v("将其他匹配语句的评分与tie_breaker相乘；")]),s._v(" "),n("li",[s._v("对以上评分求和并规范化。")]),s._v(" "),n("li",[s._v("Tier Breaker是一个介于0-1之间的浮点数。0代表使用最佳匹配；1代表所有语句同等重要。")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST blogs/_search\n{\n    "query": {\n        "dis_max": {\n            "queries": [\n                { "match": { "title": "Quick pets" }},\n                { "match": { "body":  "Quick pets" }}\n            ],\n            "tie_breaker": 0.2\n        }\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h3",{attrs:{id:"multi-match"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#multi-match"}},[s._v("#")]),s._v(" Multi Match")]),s._v(" "),n("p",[s._v("也是运用于单字符串多字段的场景下查询。")]),s._v(" "),n("p",[s._v("best_fields的场景，最佳字段，单字段之间相互竞争，又相互关联的时候。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST blogs/_search\n{\n  "query": {\n    "multi_match": {\n      "type": "best_fields",\n      "query": "Quick pets",\n      "fields": ["title","body"],\n      "tie_breaker": 0.2,\n      "minimum_should_match": "20%"\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("most fields:多数字段的场景")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT /titles\n{\n  "mappings": {\n    "properties": {\n      "title": {\n        "type": "text",\n        "analyzer": "english",\n        "fields": {"std": {"type": "text","analyzer": "standard"}}\n      }\n    }\n  }\n}\nGET /titles/_search\n{\n   "query": {\n        "multi_match": {\n            "query":  "barking dogs",\n            "type":   "most_fields",\n            "fields": [ "title", "title.std" ]\n        }\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("p",[s._v("cross_fields:用于跨字段的查询")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET address/_search\n{\n   "query": {\n        "multi_match": {\n            "query":  "Poland Street W1V",\n            "type":   "cross_fields",\n            "operator": "and",\n            "fields": [ "street", "city","country" ]\n        }\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h3",{attrs:{id:"高亮显示"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#高亮显示"}},[s._v("#")]),s._v(" 高亮显示")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST tmdb/_search\n{\n  "_source": ["title","overview"],\n  "query": {\n    "multi_match": {\n      "query": "basketball with cartoon aliens",\n      "fields": ["title","overview"]\n    }\n  },\n  "highlight" : {\n        "fields" : {\n            "overview" : { "pre_tags" : ["\\\\033[0;32;40m"], "post_tags" : ["\\\\033[0m"] },\n            "title" : { "pre_tags" : ["\\\\033[0;32;40m"], "post_tags" : ["\\\\033[0m"] }\n\n        }\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h3",{attrs:{id:"search-template"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#search-template"}},[s._v("#")]),s._v(" Search Template")]),s._v(" "),n("p",[s._v("ES中的search template是用来解耦程序的开发和ES搜索DSL的")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST _scripts/tmdb\n{\n  "script": {\n    "lang": "mustache",\n    "source": {\n      "_source": [\n        "title","overview"\n      ],\n      "size": 20,\n      "query": {\n        "multi_match": {\n          "query": "{{q}}",\n          "fields": ["title","overview"]\n        }\n      }\n    }\n  }\n}\n#调用template\nPOST tmdb/_search/template\n{\n    "id":"tmdb",\n    "params": {\n        "q": "basketball with cartoon aliens"\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("h2",{attrs:{id:"suggester-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#suggester-api"}},[s._v("#")]),s._v(" Suggester API")]),s._v(" "),n("ul",[n("li",[s._v("搜索引擎中类似的功能，在ES中是通过Suggester API实现的。")]),s._v(" "),n("li",[s._v("原理：将输入的文本分解为Token，然后在搜索的字典里查找相似的Term并返回。")]),s._v(" "),n("li",[s._v("根据不同的使用场景，ES设计了4种类别的Suggesters\n"),n("ul",[n("li",[s._v("Term & Phrase Suggester")]),s._v(" "),n("li",[s._v("Complete & Context Suggester")])])])]),s._v(" "),n("h2",{attrs:{id:"term-suggester"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#term-suggester"}},[s._v("#")]),s._v(" Term Suggester")]),s._v(" "),n("p",[s._v("有三种suggestion Mode:")]),s._v(" "),n("ul",[n("li",[s._v("Missing：如索引中已经存在，就不提供建议")]),s._v(" "),n("li",[s._v("Popular：推荐出现频率更加高的词")]),s._v(" "),n("li",[s._v("Always：无论是否存在，都提供建议。")])]),s._v(" "),n("p",[s._v('每一个建议都包含一个算分，相似性是通过levenshtein edit distance的算法实现的。核心思想就是一个词改动多少字符就可以和另外一个词一致。提供了很多可选参数来控制相似性的模糊程度。例如"max_edits"')]),s._v(" "),n("h3",{attrs:{id:"missing-mode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#missing-mode"}},[s._v("#")]),s._v(" Missing Mode")]),s._v(" "),n("p",[s._v('Suggester就是一个特殊类型的搜索。"text"里是调用时候提供的文本，通常来自于用户界面上用户输入的内容。')]),s._v(" "),n("p",[s._v('用户输入的"lucen"是一个错误的拼写。')]),s._v(" "),n("p",[s._v('回到指定的字段"body"上搜索，当无法搜索到结果时(missing)，返回建议的词。')]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST /articles/_search\n{\n  "size": 1,\n  "query": {\n    "match": {\n      "body": "lucen rock"\n    }\n  },\n  "suggest": {\n    "term-suggestion": {\n      "text": "lucen rock",\n      "term": {\n        "suggest_mode": "missing",\n        "field": "body"\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h3",{attrs:{id:"popular-mode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#popular-mode"}},[s._v("#")]),s._v(" Popular Mode")]),s._v(" "),n("p",[s._v("推荐出现频率更多高的词")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST /articles/_search\n{\n\n  "suggest": {\n    "term-suggestion": {\n      "text": "lucen rock",\n      "term": {\n        "suggest_mode": "popular",\n        "field": "body"\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h3",{attrs:{id:"always-mode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#always-mode"}},[s._v("#")]),s._v(" Always Mode")]),s._v(" "),n("p",[s._v("无论是否存在，都提供建议")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST /articles/_search\n{\n\n  "suggest": {\n    "term-suggestion": {\n      "text": "lucen rock",\n      "term": {\n        "suggest_mode": "always",\n        "field": "body",\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("sorting by frequentcy和prefix length")]),s._v(" "),n("p",[s._v('默认按照score排序，也可以按照"frequency"')]),s._v(" "),n("p",[s._v("默认首字母不一致就不会匹配推荐，但是如果将prefix_length设置为0，就会为hock建议rock")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST /articles/_search\n{\n\n  "suggest": {\n    "term-suggestion": {\n      "text": "lucen hocks",\n      "term": {\n        "suggest_mode": "always",\n        "field": "body",\n        "prefix_length":0,\n        "sort": "frequency"\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h2",{attrs:{id:"phrase-suggester"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#phrase-suggester"}},[s._v("#")]),s._v(" Phrase Suggester")]),s._v(" "),n("p",[s._v("Phrase Suggester在term suggester上增加了一些额外的逻辑。")]),s._v(" "),n("p",[s._v("例如下面的参数：")]),s._v(" "),n("ul",[n("li",[s._v("Suggest Mode: missing，popular，always")]),s._v(" "),n("li",[s._v("Max Errors：最多可以拼错的Terms数")]),s._v(" "),n("li",[s._v("Confidence：限制返回结果数，默认是1")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST /articles/_search\n{\n  "suggest": {\n    "my-suggestion": {\n      "text": "lucne and elasticsear rock hello world ",\n      "phrase": {\n        "field": "body",\n        "max_errors":2,\n        "confidence":0,\n        "direct_generator":[{\n          "field":"body",\n          "suggest_mode":"always"\n        }],\n        "highlight": {\n          "pre_tag": "<em>",\n          "post_tag": "</em>"\n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h2",{attrs:{id:"completion-suggester"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#completion-suggester"}},[s._v("#")]),s._v(" Completion Suggester")]),s._v(" "),n("ul",[n("li",[n("p",[s._v('completion Suggester提供了"自动完成"(auto complete)的功能。用户每输入一个字符，就需要即时发送一个查询请求到后端查找匹配项。')])]),s._v(" "),n("li",[n("p",[s._v("对性能要求比较苛刻。ES采用了不同的数据结构，并非通过倒排索引来完成的。而是将Analyze的数据编码成FST和索引一起存放。FST会被ES整个加载进内存，速度很快。")])]),s._v(" "),n("li",[n("p",[s._v("FST只能用于前缀查找")])])]),s._v(" "),n("h3",{attrs:{id:"使用自动补全suggester步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用自动补全suggester步骤"}},[s._v("#")]),s._v(" 使用自动补全suggester步骤")]),s._v(" "),n("p",[s._v('定义mapping，使用"completion" type')]),s._v(" "),n("p",[s._v("索引数据")]),s._v(" "),n("p",[s._v('运行"suggest"查询，得到搜索建议')]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#定义mapping\nPUT articles\n{\n  "mappings": {\n    "properties": {\n      "title_completion":{\n        "type": "completion"\n      }\n    }\n  }\n}\n#索引数据\nPOST articles/_bulk\n{ "index" : { } }\n{ "title_completion": "lucene is very cool"}\n{ "index" : { } }\n{ "title_completion": "Elasticsearch builds on top of lucene"}\n{ "index" : { } }\n{ "title_completion": "Elasticsearch rocks"}\n{ "index" : { } }\n{ "title_completion": "elastic is the company behind ELK stack"}\n{ "index" : { } }\n{ "title_completion": "Elk stack rocks"}\n{ "index" : {} }\n#使用自动补全\nPOST articles/_search?pretty\n{\n  "size": 0,\n  "suggest": {\n    "article-suggester": {\n      "prefix": "elk ",\n      "completion": {\n        "field": "title_completion"\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br")])]),n("h2",{attrs:{id:"context-suggester"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#context-suggester"}},[s._v("#")]),s._v(" Context Suggester")]),s._v(" "),n("p",[s._v("上下文建议搜索")]),s._v(" "),n("p",[s._v("context suggester是completion suggester的扩展，")]),s._v(" "),n("p",[s._v('可以在搜索中加入更多的上下文信息，例如，输入"star"')]),s._v(" "),n("ul",[n("li",[s._v('咖啡相关：建议"starbucks"')]),s._v(" "),n("li",[s._v('电影相关的："star wars"')])]),s._v(" "),n("h3",{attrs:{id:"实现上下文suggester"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现上下文suggester"}},[s._v("#")]),s._v(" 实现上下文suggester")]),s._v(" "),n("ul",[n("li",[s._v("可以定义两种类型的context\n"),n("ul",[n("li",[s._v("category 任意的字符串")]),s._v(" "),n("li",[s._v("geo 地理位置信息")])])]),s._v(" "),n("li",[s._v("实现context suggester的具体步骤\n"),n("ul",[n("li",[s._v("定制一个mapping")]),s._v(" "),n("li",[s._v("索引数据，并且为每个文档加入context信息")]),s._v(" "),n("li",[s._v("结合context进行suggestion查询")])])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#定义mapping\nPUT comments/_mapping\n{\n  "properties": {\n    "comment_autocomplete":{\n      "type": "completion",\n      "contexts":[{\n        "type":"category",\n        "name":"comment_category"\n      }]\n    }\n  }\n}\n#插入数据\nPOST comments/_doc\n{\n  "comment":"I love the star war movies",\n  "comment_autocomplete":{\n    "input":["star wars"],\n    "contexts":{\n      "comment_category":"movies"\n    }\n  }\n}\nPOST comments/_doc\n{\n  "comment":"Where can I find a Starbucks",\n  "comment_autocomplete":{\n    "input":["starbucks"],\n    "contexts":{\n      "comment_category":"coffee"\n    }\n  }\n}\n#带上下文搜索\nPOST comments/_search\n{\n  "suggest": {\n    "MY_SUGGESTION": {\n      "prefix": "sta",\n      "completion":{\n        "field":"comment_autocomplete",\n        "contexts":{\n          "comment_category":"coffee"\n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br")])]),n("h2",{attrs:{id:"metric-aggregation"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#metric-aggregation"}},[s._v("#")]),s._v(" Metric Aggregation")]),s._v(" "),n("p",[s._v("单值分析：只输出一个分析结果")]),s._v(" "),n("ul",[n("li",[s._v("min,max,avg,sum")]),s._v(" "),n("li",[s._v("cardinality (类似于distincct count)")])]),s._v(" "),n("p",[s._v("多值分析：输出多个分析结果")]),s._v(" "),n("ul",[n("li",[s._v("stats, exended stats")]),s._v(" "),n("li",[s._v("percentile, percentile rank")]),s._v(" "),n("li",[s._v("top hits (排在前面的示例)")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 多个 Metric 聚合，找到最低最高和平均工资\nPOST employees/_search\n{\n  "size": 0,\n  "aggs": {\n    "max_salary": {\n      "max": {\n        "field": "salary"\n      }\n    },\n    "min_salary": {\n      "min": {\n        "field": "salary"\n      }\n    },\n    "avg_salary": {\n      "avg": {\n        "field": "salary"\n      }\n    }\n  }\n}\n# 一个聚合，输出多值\nPOST employees/_search\n{\n  "size": 0,\n  "aggs": {\n    "stats_salary": {\n      "stats": {\n        "field":"salary"\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])]),n("h2",{attrs:{id:"bucket-aggregation"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#bucket-aggregation"}},[s._v("#")]),s._v(" Bucket Aggregation")]),s._v(" "),n("p",[s._v("按照一定的规则，将文档分配到不同的桶中，从而达到分类的目的。ES提供的一些常见的bucket aggregation。")]),s._v(" "),n("ul",[n("li",[s._v("terms")]),s._v(" "),n("li",[s._v("数字类型，有range/data range，或者histogram / data histogram")]),s._v(" "),n("li",[s._v("支持嵌套：也就是在桶里再做分桶")])]),s._v(" "),n("h3",{attrs:{id:"terms-aggregation"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#terms-aggregation"}},[s._v("#")]),s._v(" Terms Aggregation")]),s._v(" "),n("p",[s._v("在对term进行聚合的时候，如果是text类型。有两种方法，要么指定keyword字段，要么就需要打开fieldata，但是fieldata会查找出对应分词后的term。才可以进行terms aggregation")]),s._v(" "),n("ul",[n("li",[s._v("keyword默认支持doc_values")]),s._v(" "),n("li",[s._v("text需要咋mapping中enable，会按照分词后的结果进行分")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 对 Text 字段进行 terms 聚合查询，失败\nPOST employees/_search\n{\n  "size": 0,\n  "aggs": {\n    "jobs": {\n      "terms": {\n        "field":"job"\n      }\n    }\n  }\n}\n# 对keword 进行聚合\nPOST employees/_search\n{\n  "size": 0,\n  "aggs": {\n    "jobs": {\n      "terms": {\n        "field":"job.keyword"\n      }\n    }\n  }\n}\n# 对 Text 字段打开 fielddata，支持terms aggregation\nPUT employees/_mapping\n{\n  "properties" : {\n    "job":{\n       "type":     "text",\n       "fielddata": true\n    }\n  }\n}\n# 对 Text 字段进行 terms 分词。分词后的terms,结果和上面指定keyword的方式是不一样的，这是分词后的结果\nPOST employees/_search\n{\n  "size": 0,\n  "aggs": {\n    "jobs": {\n      "terms": {\n        "field":"job"\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br")])]),n("h3",{attrs:{id:"cardinality"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cardinality"}},[s._v("#")]),s._v(" Cardinality")]),s._v(" "),n("p",[s._v("类似于SQL中的Distinct")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 对job.keyword 和 job 进行 terms 聚合，分桶的总数并不一样\nPOST employees/_search\n{\n  "size": 0,\n  "aggs": {\n    "cardinate": {\n      "cardinality": {\n        "field": "job"\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h3",{attrs:{id:"指定size分桶"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#指定size分桶"}},[s._v("#")]),s._v(" 指定SIZE分桶")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#指定 bucket 的 size\nPOST employees/_search\n{\n  "size": 0,\n  "aggs": {\n    "ages_5": {\n      "terms": {\n        "field":"age",\n        "size":3\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h3",{attrs:{id:"嵌套聚合"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#嵌套聚合"}},[s._v("#")]),s._v(" 嵌套聚合")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 指定size，不同工种中，年纪最大的3个员工的具体信息\nPOST employees/_search\n{\n  "size": 0,\n  "aggs": {\n    "jobs": {\n      "terms": {\n        "field":"job.keyword"\n      },\n      "aggs":{\n        "old_employee":{\n          "top_hits":{\n            "size":3,\n            "sort":[\n              {\n                "age":{\n                  "order":"desc"\n                }\n              }\n            ]\n          }\n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("h3",{attrs:{id:"优化terms聚合性能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#优化terms聚合性能"}},[s._v("#")]),s._v(" 优化terms聚合性能")]),s._v(" "),n("p",[s._v("通过指定mapping中，打开eager_global_ordinals为true，这会让索引数据的时候就开始对数据文档进行预先处理，这样对于要求频繁使用聚合的场景，或者说是要对聚合实时数据有更高的性能的时候来使用。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('put index\n{\n  "mappings": {\n    "properties": {\n      "foo": {\n        "type": "keyword",\n        "eager_global_ordinals": true\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h3",{attrs:{id:"range-聚合"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#range-聚合"}},[s._v("#")]),s._v(" Range 聚合")]),s._v(" "),n("p",[s._v("自己自定义range")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#Salary Ranges 分桶，可以自己定义 key\nPOST employees/_search\n{\n  "size": 0,\n  "aggs": {\n    "salary_range": {\n      "range": {\n        "field":"salary",\n        "ranges":[\n          {\n            "to":10000\n          },\n          {\n            "from":10000,\n            "to":20000\n          },\n          {\n            "key":">20000",\n            "from":20000\n          }\n        ]\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("h3",{attrs:{id:"histogram聚合"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#histogram聚合"}},[s._v("#")]),s._v(" Histogram聚合")]),s._v(" "),n("p",[s._v("通过指定分桶的间隔，来进行分桶")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#Salary Histogram,工资0到10万，以 5000一个区间进行分桶\nPOST employees/_search\n{\n  "size": 0,\n  "aggs": {\n    "salary_histrogram": {\n      "histogram": {\n        "field":"salary",\n        "interval":5000,\n        "extended_bounds":{\n          "min":0,\n          "max":100000\n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h2",{attrs:{id:"pipeline-聚合分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pipeline-聚合分析"}},[s._v("#")]),s._v(" Pipeline 聚合分析")]),s._v(" "),n("p",[s._v("pipeline管道的概念：支持对聚合分析的结果，再次进行聚合分析。")]),s._v(" "),n("p",[s._v("Pipeline的分析结果会输出到原结果中，根据位置的不同，分为两类：")]),s._v(" "),n("ul",[n("li",[s._v("Sibling 结果和现有分析结果同级\n"),n("ul",[n("li",[s._v("max，min，avg & sum bucket")]),s._v(" "),n("li",[s._v("stats , extended status buccket")]),s._v(" "),n("li",[s._v("percentiles bucket")])])]),s._v(" "),n("li",[s._v("Parent 结果内嵌到现有的聚合分析结果之中\n"),n("ul",[n("li",[s._v("derivative (求导)")]),s._v(" "),n("li",[s._v("cumultive sum（累计求和）")]),s._v(" "),n("li",[s._v("moving function (滑动窗口)")])])])]),s._v(" "),n("h3",{attrs:{id:"sibling-pipeline"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sibling-pipeline"}},[s._v("#")]),s._v(" Sibling Pipeline")]),s._v(" "),n("p",[s._v("查看到平均工资最低的工作类型")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 平均工资最低的工作类型\nPOST employees/_search\n{\n  "size": 0,\n  "aggs": {\n    "jobs": {\n      "terms": {\n        "field": "job.keyword",\n        "size": 10\n      },\n      "aggs": {\n        "avg_salary": {\n          "avg": {\n            "field": "salary"\n          }\n        }\n      }\n    },\n    "min_salary_by_job":{\n      "min_bucket": {\n        "buckets_path": "jobs>avg_salary"\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[s._v("平均工资的统计分析")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 平均工资的统计分析\nPOST employees/_search\n{\n  "size": 0,\n  "aggs": {\n    "jobs": {\n      "terms": {\n        "field": "job.keyword",\n        "size": 10\n      },\n      "aggs": {\n        "avg_salary": {\n          "avg": {\n            "field": "salary"\n          }\n        }\n      }\n    },\n    "stats_salary_by_job":{\n      "stats_bucket": {\n        "buckets_path": "jobs>avg_salary"\n      }\n    }\n  }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("h3",{attrs:{id:"parent-pipeline"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#parent-pipeline"}},[s._v("#")]),s._v(" Parent Pipeline")]),s._v(" "),n("p",[s._v("按照年龄，对工资进行求导(看工资发展的趋势)")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#按照年龄对平均工资求导\nPOST employees/_search\n{\n  "size": 0,\n  "aggs": {\n    "age": {\n      "histogram": {\n        "field": "age",\n        "min_doc_count": 1,\n        "interval": 1\n      },\n      "aggs": {\n        "avg_salary": {\n          "avg": {\n            "field": "salary"\n          }\n        },\n        "derivative_avg_salary":{\n          "derivative": {\n            "buckets_path": "avg_salary"\n          }\n        }\n      }\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);