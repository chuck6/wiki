(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{771:function(s,r,a){"use strict";a.r(r);var e=a(20),t=Object(e.a)({},(function(){var s=this,r=s.$createElement,a=s._self._c||r;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"harbor镜像管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harbor镜像管理"}},[s._v("#")]),s._v(" Harbor镜像管理")]),s._v(" "),a("h2",{attrs:{id:"harbor架构解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harbor架构解析"}},[s._v("#")]),s._v(" Harbor架构解析")]),s._v(" "),a("h3",{attrs:{id:"harbor介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harbor介绍"}},[s._v("#")]),s._v(" Harbor介绍")]),s._v(" "),a("p",[s._v("Vmware公司开源的企业级容器registry项目harbor，是由vmware中国研发团队负责开发。Harbor可以帮助用户迅速搭建企业级的registry服务，它提供了管理图形界面，基于角色的访问控制RBAC，镜像远程复制（同步），AD/LDAP集成、以及审计日志等企业用户需求的功能，同时还原生支持中文和英文，深受国内外用户的喜爱。")]),s._v(" "),a("h3",{attrs:{id:"harbor核心组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harbor核心组件"}},[s._v("#")]),s._v(" Harbor核心组件")]),s._v(" "),a("p",[a("strong",[s._v("Proxy")]),s._v(": 是一个nginx的前端代理，代理harbor的registry，UI，token等服务。")]),s._v(" "),a("p",[a("strong",[s._v("DB")]),s._v(": 负责存储用户权限、审计日志、dockerimage分组信息等数据。")]),s._v(" "),a("p",[a("strong",[s._v("Jobservice")]),s._v(": jobservice是负责镜像复制工作的，和registry通信，从一个registry pull镜像然后push到另一个registry，并记录job_log。")]),s._v(" "),a("p",[a("strong",[s._v("Core")]),s._v(": harbor的核心组件，主要提供权限管理、审计、管理界面UI、token service以及可供其他系统调用的API等功能。")]),s._v(" "),a("p",[a("strong",[s._v("Log")]),s._v(": 为了帮助监控harbor运行，负责收集其他组件的log。")]),s._v(" "),a("p",[a("strong",[s._v("Redis")]),s._v(": 用于存储session。")]),s._v(" "),a("p",[s._v("注意：新版本1.8中新增了registryctl/ harbor-portal等服务。")]),s._v(" "),a("h3",{attrs:{id:"harbor和registry的比较"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harbor和registry的比较"}},[s._v("#")]),s._v(" Harbor和registry的比较")]),s._v(" "),a("p",[s._v("Harbor和registry都是docker的镜像仓库，相比较于registry，有很多的优势。")]),s._v(" "),a("ol",[a("li",[s._v("提供分层传输机制，优化网络传输")])]),s._v(" "),a("p",[s._v("Docker 镜像是分层的，如果每次每次传输都使用全量文件，不经济。必须提供识别分层传输的机制，以层的UUID未标识，确定传输的对象。")]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("提供WEB界面，优化用户体验")])]),s._v(" "),a("p",[s._v("只用镜像的名字来进行上传下载很不方便，需要有一个用户界面可以支持登录、搜索功能，包括区分公有、私有镜像。")]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[s._v("支持水平扩展集群")])]),s._v(" "),a("p",[s._v("当有用户对镜像的上传下载操作集中在某服务器，需要对相应的访问压力作分解。")]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("良好的安全机制")])]),s._v(" "),a("p",[s._v("Registry缺少认证机制，任何人基于不同角色的访问控制机制。")]),s._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[s._v("定时清理")])]),s._v(" "),a("p",[s._v("Registry缺乏镜像清理机制。")]),s._v(" "),a("h3",{attrs:{id:"简略架构图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简略架构图"}},[s._v("#")]),s._v(" 简略架构图")]),s._v(" "),a("p",[a("img",{attrs:{src:"E:%5Ctupian%5Charbor_1.png",alt:"image-20200817150317207"}})]),s._v(" "),a("h2",{attrs:{id:"系统环境及部署准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统环境及部署准备"}},[s._v("#")]),s._v(" 系统环境及部署准备")]),s._v(" "),a("h3",{attrs:{id:"增加主机名称解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#增加主机名称解析"}},[s._v("#")]),s._v(" 增加主机名称解析")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("192.168.3.58 server58\n192.168.3.59 server59\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"主机时间同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主机时间同步"}},[s._v("#")]),s._v(" 主机时间同步")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Ntp server配置\n# vi /etc/ntp.conf\n注释掉下面行，并添加下面两行\n#server 0.centos.pool.ntp.org iburst\n#server 1.centos.pool.ntp.org iburst\n#server 2.centos.pool.ntp.org iburst\n#server 3.centos.pool.ntp.org iburst\nserver 127.127.1.0\nfudge 127.127.1.0 stratum 11\nNtp Client配置\n注释掉下面行，并添加下面一行\n#server 0.centos.pool.ntp.org iburst\n#server 1.centos.pool.ntp.org iburst\n#server 2.centos.pool.ntp.org iburst\n#server 3.centos.pool.ntp.org iburst\nserver 192.168.3.58\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h3",{attrs:{id:"关闭防火墙服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭防火墙服务"}},[s._v("#")]),s._v(" 关闭防火墙服务")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("先事先关闭所有主机上的iptables或firewalld服务：\n#systemctl stop firewalld \n#systemctl stop iptables\n#systemctl disable firewalld\n#systemctl disable iptables\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"关闭并禁用selinux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭并禁用selinux"}},[s._v("#")]),s._v(" 关闭并禁用SElinux")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#vi /etc/selinux/config\n修改SELINUX配置\nSELINUX=disabled\n重启后生效\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"系统内核参数修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统内核参数修改"}},[s._v("#")]),s._v(" 系统内核参数修改")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#vi /etc/sysctl.conf \n#add by common\nfs.aio-max-nr = 1048576\nfs.file-max = 6815744\nkernel.shmall = 2097152\nkernel.shmmax = 536870912\nkernel.shmmni = 4096\nkernel.sem = 250 32000 100 128\nnet.core.rmem_default = 262144\nnet.core.rmem_max = 4194304\nnet.core.wmem_default = 262144\nnet.core.wmem_max = 1048586\nnet.core.somaxconn = 2048\nnet.ipv4.tcp_max_syn_backlog = 2048\nnet.ipv4.tcp_timestamps = 0\nnet.ipv4.tcp_synack_retries = 2\nnet.ipv4.tcp_syn_retries = 2\nnet.ipv4.tcp_tw_recycle = 1\nnet.ipv4.tcp_tw_reuse = 1\n#add by mq\nvm.overcommit_memory=1\nvm.drop_caches=1\nvm.zone_reclaim_mode=0\nvm.max_map_count=655360\nvm.dirty_background_ratio=50\nvm.dirty_ratio=50\nvm.page-cluster=3\nvm.dirty_writeback_centisecs=360000\n#add by teledb\nvm.min_free_kbytes=65536\nvm.swappiness=10\n#sysctl –p\n#echo 'ulimit -n 655350' >> /etc/profile\n#vi /etc/security/limits.conf \n* soft nofile 655350\n* hard nofile 655350\n* hard nproc 655350\n* soft nproc 655350\n* hard stack unlimited\n* soft stact unlimited\n#vi /etc/security/limits.d/20-nproc.conf \nroot       soft    nproc     unlimited\n* soft nofile 655350\n* hard nofile 655350\n* hard nproc 655350\n* soft nproc 655350\n* hard stack unlimited\n* soft stact unlimited\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br")])]),a("h3",{attrs:{id:"部署docker环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署docker环境"}},[s._v("#")]),s._v(" 部署docker环境")]),s._v(" "),a("p",[s._v("部署docker环境，请参考其他文档。")]),s._v(" "),a("h2",{attrs:{id:"部署操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署操作"}},[s._v("#")]),s._v(" 部署操作")]),s._v(" "),a("h3",{attrs:{id:"docker-compose安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose安装"}},[s._v("#")]),s._v(" docker-compose安装")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1)\t下载指定的版本，注意docker-compose file的格式和对docker版本的支持\n####查看网页https://github.com/docker/compose/releases\n执行下面命令下载：\n#curl -L https://github.com/docker/compose/releases/download/1.24.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose\n# chmod +x /usr/local/bin/docker-compose\n2)\t查看是否安装成功\n# docker-compose –version\n3)\t加入到/usr/bin路径下\n#ln –s xxx/docker-compose  /usr/bin/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"harbor服务搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harbor服务搭建"}},[s._v("#")]),s._v(" harbor服务搭建")]),s._v(" "),a("h4",{attrs:{id:"下载harbor包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载harbor包"}},[s._v("#")]),s._v(" 下载harbor包")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("从下面的url中下载最新的harbor包，选择offline下载\nhttps://github.com/goharbor/harbor/tags\n$tar –xvf harbor-offline-installer-v1.8.0.tgz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"修改harbor参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改harbor参数"}},[s._v("#")]),s._v(" 修改harbor参数")]),s._v(" "),a("p",[s._v("修改harbor.yml文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1)\t修改hostname为本机的IP地址\n2)\t修改port为本机对外访问的端口\n3)\t修改data_volume为存储所有harbor文件路径\n4)\t修改location是存储日志的路径\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"执行prepare脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行prepare脚本"}},[s._v("#")]),s._v(" 执行prepare脚本")]),s._v(" "),a("p",[a("code",[s._v("$./prepare")])]),s._v(" "),a("p",[s._v("执行这个脚本后，会根据修改的harbor.yml文件来修改docker-compose.yml文件，并且会下载goharbor/prepare: v1.8.0这个镜像，如果是离线部署的话，需要提前下载好这个镜像放到服务器本机的镜像仓库中。")]),s._v(" "),a("h3",{attrs:{id:"执行install-sh脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行install-sh脚本"}},[s._v("#")]),s._v(" 执行install.sh脚本")]),s._v(" "),a("p",[a("code",[s._v("$./install.sh")])]),s._v(" "),a("p",[s._v("执行完这个脚本后，会检查本机的docker/docker-compose环境，随后会下载所有相关的harbor的images镜像，然后针对harbor解压目录中的config文件进行配置，随后启动harbor各个相关的容器。")]),s._v(" "),a("p",[s._v("如果是离线部署，需要提前下载好所有的images，具体的images如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("goharbor/chartmuseum-photon:v0.8.1-v1.8.0\ngoharbor/harbor-migrator:v1.8.0\ngoharbor/redis-photon:v1.8.0\ngoharbor/clair-photon:v2.0.8-v1.8.0\ngoharbor/notary-server-photon:v0.6.1-v1.8.0\ngoharbor/notary-signer-photon:v0.6.1-v1.8.0\ngoharbor/harbor-registryctl:v1.8.0\ngoharbor/registry-photon:v2.7.1-patch-2819-v1.8.0\ngoharbor/nginx-photon:v1.8.0\ngoharbor/harbor-log:v1.8.0\ngoharbor/harbor-jobservice:v1.8.0\ngoharbor/harbor-core:v1.8.0\ngoharbor/harbor-portal:v1.8.0\ngoharbor/harbor-db:v1.8.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"harbor登录及使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harbor登录及使用"}},[s._v("#")]),s._v(" Harbor登录及使用")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("http://IP:port   admin  Harbor12345\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"常见操作命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见操作命令"}},[s._v("#")]),s._v(" 常见操作命令")]),s._v(" "),a("h3",{attrs:{id:"harbor服务的启停"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harbor服务的启停"}},[s._v("#")]),s._v(" Harbor服务的启停")]),s._v(" "),a("p",[s._v("进入到harbor的解压缩目录后，执行下面的命令，其中操作的所有容器，默认情况下docker-compose就是操作同目录下的docker-compose.yml文件，如果使用其他yml文件，可以使用-f自己指定。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1)\t后台启动harbor各个服务，如果容器不存在根据镜像自动创建\n$docker-compose up –d \n2)\t停止容器并删除容器\n$docker-compose down -v\n3)\t启动容器，容器不存在就无法启动，不会自动创建镜像\n$docker-compose start\n4)\t停止容器\n$docker-compose stop\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"harbor各个服务的端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harbor各个服务的端口"}},[s._v("#")]),s._v(" Harbor各个服务的端口")]),s._v(" "),a("p",[s._v("查看docker-compose.yml配置文件可以看出，除了harbor-log监听了本地127.0.0.1上的1514端口，还有nginx监听了本地所有网卡地址的8888端口，其余的容器都是使用的docker容器的内部网络链接。")]),s._v(" "),a("p",[s._v("通过执行$docker network ls 可以查看容器都是用了一个叫做harbor-harbor的docker网络，drive类型也是bridge。")]),s._v(" "),a("h3",{attrs:{id:"修改docker私有仓库地址配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改docker私有仓库地址配置"}},[s._v("#")]),s._v(" 修改docker私有仓库地址配置")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("修改docker系统服务，引入系统变量配置文件。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# vi /usr/lib/systemd/system/docker.service\n在[Service]目录下，ExecStart之前添加如下配置\nEnvironmentFile=-/etc/docker/daemon.json\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("添加daemon.json配置文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#vi /etc/docker/daemon.json\n{\n  “insecure-registries": [“x.x.x.x:port”]\n}\n#systemctl daemon-reload\n#systemctl restart docker\n$docker info       //可以查看具体的insecure-registries配置是否生效\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"上传-下载仓库镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上传-下载仓库镜像"}},[s._v("#")]),s._v(" 上传/下载仓库镜像")]),s._v(" "),a("p",[s._v("在harbor仓库中分为公有仓库和私有仓库，公有仓库下载不需要用户密码鉴权，公有仓库无法上传。私有仓库的上传下载需要用户鉴权。")]),s._v(" "),a("p",[s._v("示例上传如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$docker tag rancher/pause:3.1  192.168.3.60:8888/test/rancher/pause:3.1  //test是创建仓库项目\n$docker login 192.168.3.60:8888\n$docker push 192.168.3.60:8888/test/rancher/pause:3.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("示例下载如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ docker login 192.168.3.60:8888\n$ docker pull 192.168.3.60:8888/test/rancher/pause:3.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"仓库进行同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#仓库进行同步"}},[s._v("#")]),s._v(" 仓库进行同步")]),s._v(" "),a("h4",{attrs:{id:"harbor仓库push镜像到registry仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harbor仓库push镜像到registry仓库"}},[s._v("#")]),s._v(" Harbor仓库push镜像到registry仓库")]),s._v(" "),a("ol",[a("li",[s._v("“仓库管理”分别创建harbor仓库和registry仓库的两个目标，其中habor仓库目标中的目标URL类似：”http://192.168.3.60:8888/test”，其中test是新创建的仓库项目。")]),s._v(" "),a("li",[s._v("“同步管理”中新建规则，规则的同步模式是push-based，指明目标的registry。")]),s._v(" "),a("li",[s._v("选择新建的规则，点击”同步”。")])]),s._v(" "),a("h4",{attrs:{id:"harbor仓库从registry仓库pull镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harbor仓库从registry仓库pull镜像"}},[s._v("#")]),s._v(" Harbor仓库从registry仓库pull镜像")]),s._v(" "),a("ol",[a("li",[s._v("同上，新建两个仓库的目标。")]),s._v(" "),a("li",[s._v("“同步管理”中新建规则，规则的同步模式是pull-based，指明源registry地址。")]),s._v(" "),a("li",[s._v("选择新建的规则，点击”同步”。")])])])}),[],!1,null,null,null);r.default=t.exports}}]);